<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>Automating Tasks With X64dbg Scripts - The Reverser&#39;s Draft</title><meta name="author" content="moval0x1">
<meta name="description" content="A short explanation of how to use x64dbg scripts to help in daily tasks"><meta name="keywords" content='Malware, Reversing, Scripts'>
  <meta itemprop="name" content="Automating Tasks With x64dbg Scripts">
  <meta itemprop="description" content="A short explanation of how to use x64dbg scripts to help in daily tasks">
  <meta itemprop="datePublished" content="2024-08-28T19:23:17-03:00">
  <meta itemprop="dateModified" content="2024-08-28T19:23:17-03:00">
  <meta itemprop="wordCount" content="1016">
  <meta itemprop="image" content="https://moval0x1.github.io/logo.png">
  <meta itemprop="keywords" content="Malware,Reversing,Scripts"><meta property="og:url" content="https://moval0x1.github.io/posts/automating-tasks-with-x64dbg-scripts/">
  <meta property="og:site_name" content="The Reverser&#39;s Draft">
  <meta property="og:title" content="Automating Tasks With x64dbg Scripts">
  <meta property="og:description" content="A short explanation of how to use x64dbg scripts to help in daily tasks">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-28T19:23:17-03:00">
    <meta property="article:modified_time" content="2024-08-28T19:23:17-03:00">
    <meta property="article:tag" content="Malware">
    <meta property="article:tag" content="Reversing">
    <meta property="article:tag" content="Scripts">
    <meta property="og:image" content="https://moval0x1.github.io/logo.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://moval0x1.github.io/logo.png">
  <meta name="twitter:title" content="Automating Tasks With x64dbg Scripts">
  <meta name="twitter:description" content="A short explanation of how to use x64dbg scripts to help in daily tasks">
      <meta name="twitter:site" content="@moval0x1">
<meta name="twitter:creator" content="@moval0x1" /><meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="https://moval0x1.github.io/posts/automating-tasks-with-x64dbg-scripts/" title="Automating Tasks With x64dbg Scripts - The Reverser&#39;s Draft" /><link rel="prev" type="text/html" href="https://moval0x1.github.io/posts/the-abuse-of-exception-handlers/" title="The Abuse of Exception Handlers" /><link rel="next" type="text/html" href="https://moval0x1.github.io/about/" title="About" /><link rel="stylesheet" href="/css/config.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Automating Tasks With x64dbg Scripts",
    "inLanguage": "en-us",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/moval0x1.github.io\/posts\/automating-tasks-with-x64dbg-scripts\/"
    },"image": [{
              "@type": "ImageObject",
              "url": "https:\/\/moval0x1.github.io\/images\/profile.jpg",
              "width":  457 ,
              "height":  457 
            }],"genre": "posts","keywords": "Malware, Reversing, Scripts","wordcount":  1016 ,
    "url": "https:\/\/moval0x1.github.io\/posts\/automating-tasks-with-x64dbg-scripts\/","datePublished": "2024-08-28T19:23:17-03:00","dateModified": "2024-08-28T19:23:17-03:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "moval0x1"
      },"description": "A short explanation of how to use x64dbg scripts to help in daily tasks"
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="The Reverser&#39;s Draft"><span class="header-title-text">The Reverser&#39;s Draft</span></a><span class="typeit header-subtitle"><template>Coding &amp; Malware &amp; Reverse Engineering</template></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/posts/"><i class="fa-solid fa-file-lines fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a class="menu-link" href="/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a class="menu-link" href="/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item">
              <a class="menu-link" href="/about/"><i class="fa-solid fa-solid fa-user fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title="Switch Theme">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="The Reverser&#39;s Draft"><span class="header-title-text">The Reverser&#39;s Draft</span></a><span class="typeit header-subtitle"><template>Coding &amp; Malware &amp; Reverse Engineering</template></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="menu-item"><a class="menu-link" href="/posts/"><i class="fa-solid fa-file-lines fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item"><a class="menu-link" href="/categories/"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item"><a class="menu-link" href="/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item"><a class="menu-link" href="/about/"><i class="fa-solid fa-solid fa-user fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><main class="fi-container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>Automating Tasks With X64dbg Scripts</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="/about" title="Author" rel=" author" class="author"><img class="avatar" src='/images/profile.jpg' alt="moval0x1" height="16" width="16">&nbsp;moval0x1</a></span><span class="post-included-in">&nbsp;included in <a href="/categories/scripts/" class="post-category" title="Category - Scripts"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> Scripts</a></span></div><div class="post-meta-line"><span title="published on 2024-08-28 19:23:17"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2024-08-28">2024-08-28</time></span>&nbsp;<span title="1016 words"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>About 1100 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>5 minutes</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Contents</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#a-short-overview-of-x64dbg">A short overview of x64dbg</a></li>
    <li><a href="#what-are-x64dbg-scripts">What are x64dbg scripts?</a></li>
    <li><a href="#how-can-we-use-it">How can we use it?</a>
      <ul>
        <li><a href="#some-simple-examples">Some simple examples</a>
          <ul>
            <li><a href="#log-command">Log command</a></li>
            <li><a href="#msg-command">Msg command</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#using-it-in-real-life">Using it in real life</a></li>
    <li><a href="#getting-the-first-malware-sample">Getting the first malware sample</a></li>
    <li><a href="#understand-it-first-part">Understand it, first part</a></li>
    <li><a href="#crafting-the-easiest-script-in-the-world">Crafting the easiest script in the world</a></li>
    <li><a href="#getting-the-second-malware-sample">Getting the second malware sample</a></li>
    <li><a href="#understand-it-second-part">Understand it, second part</a>
      <ul>
        <li><a href="#triage">Triage</a></li>
        <li><a href="#the-themida-script">The Themida Script</a></li>
      </ul>
    </li>
    <li><a href="#breaking-down-the-script">Breaking Down the Script</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><h2 class="heading-element" id="a-short-overview-of-x64dbg"><span>A short overview of x64dbg</span>
  <a href="#a-short-overview-of-x64dbg" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><img loading="lazy" src='/images/x64dbgScripts/x64dbg-logo.png' alt="x64dbg logo" height="430" width="479"></p>
<p>According to <a href="https://x64dbg.com/#"target="_blank" rel="external nofollow noopener noreferrer"><strong>x64bg</strong></a> website, it is <em>an open-source x64/x32 debugger for windows</em>. You can find an extensible list of features there.</p>
<p>If you are generally interested in reverse engineering, you&rsquo;ll undoubtedly use x64dbg and I&rsquo;m sure you&rsquo;ll love it. Thanks for the fantastic tool <a href="https://github.com/mrexodia"target="_blank" rel="external nofollow noopener noreferrer"><strong>mrexodia</strong></a>.</p>
<h2 class="heading-element" id="what-are-x64dbg-scripts"><span>What are x64dbg scripts?</span>
  <a href="#what-are-x64dbg-scripts" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>x64dbg scripts are small chunks of instructions that are executed step by step. All the script commands are described <a href="https://help.x64dbg.com/en/latest/commands/index.html"target="_blank" rel="external nofollow noopener noreferrer"><strong>here</strong></a>. Let&rsquo;s start with a <em>&ldquo;Hello World!&rdquo;</em> as usual.</p>
<p>We can do it in two different ways: <a href="https://help.x64dbg.com/en/latest/commands/script/log.html"target="_blank" rel="external nofollow noopener noreferrer"><strong>log</strong></a> command or <a href="https://help.x64dbg.com/en/latest/commands/script/msg.html"target="_blank" rel="external nofollow noopener noreferrer"><strong>msg</strong></a> command. Both of them are super easy to work with!</p>
<h2 class="heading-element" id="how-can-we-use-it"><span>How can we use it?</span>
  <a href="#how-can-we-use-it" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>It is possible to execute these commands directly on the script tab, save a file, and load it on the script part, or type both in the <strong>command bar</strong>. In the first example, I used the <strong>command bar</strong> to execute the script.</p>
<h3 class="heading-element" id="some-simple-examples"><span>Some simple examples</span>
  <a href="#some-simple-examples" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h4 class="heading-element" id="log-command"><span>Log command</span>
  <a href="#log-command" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-as" data-lang="as"><span style="display:flex;"><span><span style="color:#a6e22e">log</span> <span style="color:#e6db74">&#34;Hello World!&#34;</span></span></span></code></pre></div><p><img loading="lazy" src='/images/x64dbgScripts/x64dbg-log-helloworld.png' alt="x64dbg log Hello World" height="86" width="174"></p>
<h4 class="heading-element" id="msg-command"><span>Msg command</span>
  <a href="#msg-command" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-as" data-lang="as"><span style="display:flex;"><span><span style="color:#a6e22e">msg</span> <span style="color:#e6db74">&#34;Hello World!&#34;</span></span></span></code></pre></div><p><img loading="lazy" src='/images/x64dbgScripts/x64dbg-msg-helloworld.png' alt="x64dbg msg Hello World" height="121" width="131"></p>
<h2 class="heading-element" id="using-it-in-real-life"><span>Using it in real life</span>
  <a href="#using-it-in-real-life" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><figure><a class="lightgallery" href="/images/x64dbgScripts/dwight-lets-do-this.gif" title="Let&#39;s do this!" data-thumbnail="/images/x64dbgScripts/dwight-lets-do-this.gif" data-sub-html="<h2>Lets do this!</h2><p>Let&#39;s do this!</p>"><img loading="lazy" src='/images/x64dbgScripts/dwight-lets-do-this.gif' alt="Lets do this!" height="400" width="480"></a><figcaption class="image-caption">Let's do this!</figcaption>
  </figure></p>
<h2 class="heading-element" id="getting-the-first-malware-sample"><span>Getting the first malware sample</span>
  <a href="#getting-the-first-malware-sample" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>On <a href="https://bazaar.abuse.ch/sample/7e18e5fe9e980c48ad67cc2ce7423e818e15c1256e2ffe4ce85c5cfbd5b30877/"target="_blank" rel="external nofollow noopener noreferrer"><strong>MalwareBazaar</strong></a> I&rsquo;ve collect a <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.darkgate"target="_blank" rel="external nofollow noopener noreferrer"><strong>DarkGate</strong></a> sample to start our analyzis.</p>
<blockquote>
<p>First documented in 2018, DarkGate is a commodity loader with features that include the ability to download and execute files to memory, a Hidden Virtual Network Computing (HVNC) module, keylogging, information-stealing capabilities, and privilege escalation. DarkGate makes use of legitimate AutoIt files and typically runs multiple AutoIt scripts. New versions of DarkGate have been advertised on a Russian language eCrime forum since May 2023.</p>
</blockquote>
<h2 class="heading-element" id="understand-it-first-part"><span>Understand it, first part</span>
  <a href="#understand-it-first-part" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>This sample dropped an <strong>AutoIt</strong> and started it, so it was not a good choice in this example of x64dbg scripts. At that time, I had just opened the MalwareBazaar website and collected the first sample. So, I&rsquo;ve decided to keep it to show another option (a quite simple one).</p>
<p>When I opened the debugger, I focused on creating the process. My thoughts were to use <a href="https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa"target="_blank" rel="external nofollow noopener noreferrer"><strong>CreateProcessA</strong></a> to collect the second parameter, which is the command line, and log it.</p>
<h2 class="heading-element" id="crafting-the-easiest-script-in-the-world"><span>Crafting the easiest script in the world</span>
  <a href="#crafting-the-easiest-script-in-the-world" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-as" data-lang="as"><span style="display:flex;"><span><span style="color:#75715e">// Go to entrypoint
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">run</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Clear all breakpoints
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">bpc</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bphc</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bpmc</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Set the breakpoint
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">bp</span> <span style="color:#a6e22e">CreateProcessA</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">run</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Log the commandLine argument
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">log</span> <span style="color:#e6db74">&#34;[+] {s:esp+8}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">msg</span> <span style="color:#e6db74">&#34;Now, take a look on the LOG tab!&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ret</span></span></span></code></pre></div><p>To load it on the x64dbg, we can find a tab called &ldquo;Script&rdquo;.</p>
<p><figure><a class="lightgallery" href="/images/x64dbgScripts/x64dbg-script-tab.png" title="x64dbg script tab" data-thumbnail="/images/x64dbgScripts/x64dbg-script-tab.png" data-sub-html="<h2>x64dbg script tab</h2><p>x64dbg script tab</p>"><img loading="lazy" src='/images/x64dbgScripts/x64dbg-script-tab.png' alt="x64dbg script tab" height="75" width="1153"></a><figcaption class="image-caption">x64dbg script tab</figcaption>
  </figure></p>
<p><strong>Right click &gt; Load Script</strong> and then load from a file or paste it directly.</p>
<p><figure><a class="lightgallery" href="/images/x64dbgScripts/x64dbg-load-script-options.png" title="x64dbg load script options" data-thumbnail="/images/x64dbgScripts/x64dbg-load-script-options.png" data-sub-html="<h2>x64dbg load script</h2><p>x64dbg load script options</p>"><img loading="lazy" src='/images/x64dbgScripts/x64dbg-load-script-options.png' alt="x64dbg load script" height="268" width="1154"></a><figcaption class="image-caption">x64dbg load script options</figcaption>
  </figure></p>
<p>And that is the result of running this script.</p>
<p><figure><a class="lightgallery" href="/images/x64dbgScripts/x64dbg-log-darkgate.png" title="x64dbg log tab after script execution" data-thumbnail="/images/x64dbgScripts/x64dbg-log-darkgate.png" data-sub-html="<h2>x64dbg log script execution</h2><p>x64dbg log tab after script execution</p>"><img loading="lazy" src='/images/x64dbgScripts/x64dbg-log-darkgate.png' alt="x64dbg log script execution" height="93" width="568"></a><figcaption class="image-caption">x64dbg log tab after script execution</figcaption>
  </figure></p>
<p>Really easy, isn&rsquo;t it? Let&rsquo;s try another one with more challenges to solve.</p>
<h2 class="heading-element" id="getting-the-second-malware-sample"><span>Getting the second malware sample</span>
  <a href="#getting-the-second-malware-sample" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Here I collect a really good example to this post, a <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.mars_stealer"target="_blank" rel="external nofollow noopener noreferrer"><strong>MarsStealer</strong></a> sample from <a href="https://bazaar.abuse.ch/sample/6509ea13b16d01894b8c084fc4fd292651d1ae88a59dfc63d2f87d8dbbcc6f03/"target="_blank" rel="external nofollow noopener noreferrer"><strong>MalwareBazaar</strong></a>.</p>
<blockquote>
<p>3xp0rt describes Mars Stealer as an improved successor of Oski Stealer, supporting stealing from current browsers and targeting crypto currencies and 2FA plugins.</p>
</blockquote>
<h2 class="heading-element" id="understand-it-second-part"><span>Understand it, second part</span>
  <a href="#understand-it-second-part" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 class="heading-element" id="triage"><span>Triage</span>
  <a href="#triage" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>On <a href="https://github.com/horsicq/Detect-It-Easy"target="_blank" rel="external nofollow noopener noreferrer"><strong>DiE</strong></a> it does not tell us much about the file, looks like a <em>normal</em> file, right?</p>
<p><figure><a class="lightgallery" href="/images/x64dbgScripts/die-marsstealer.png" title="DiE MarsStealer scan" data-thumbnail="/images/x64dbgScripts/die-marsstealer.png" data-sub-html="<h2>DiE marsStealer scan</h2><p>DiE MarsStealer scan</p>"><img loading="lazy" src='/images/x64dbgScripts/die-marsstealer.png' alt="DiE marsStealer scan" height="532" width="722"></a><figcaption class="image-caption">DiE MarsStealer scan</figcaption>
  </figure></p>
<p>Using a second <a href="https://github.com/4n0nym0us/4n4lDetector"target="_blank" rel="external nofollow noopener noreferrer"><strong>option</strong></a> to scan, we find out that we are dealing with a version of <a href="https://www.oreans.com/Themida.php"target="_blank" rel="external nofollow noopener noreferrer"><strong>Themida</strong></a>.</p>
<p><figure><a class="lightgallery" href="/images/x64dbgScripts/4detector-themida.png" title="Themida 2.x is identified" data-thumbnail="/images/x64dbgScripts/4detector-themida.png" data-sub-html="<h2>4detector themida</h2><p>Themida 2.x is identified</p>"><img loading="lazy" src='/images/x64dbgScripts/4detector-themida.png' alt="4detector themida" height="686" width="881"></a><figcaption class="image-caption">Themida 2.x is identified</figcaption>
  </figure></p>
<h3 class="heading-element" id="the-themida-script"><span>The Themida Script</span>
  <a href="#the-themida-script" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>So, this time, I was really lucky! Now, I have a perfect example of how scripts can be helpful in our daily jobs.
On the x64dbg Github we found some excellent scripts and fortunately, one of them is a <a href="https://github.com/x64dbg/Scripts/blob/9decfb862e11052b53d045a63e7fcd927fe8027f/Themida%20v2.x.x.x%20OEP%20Finder.txt"target="_blank" rel="external nofollow noopener noreferrer"><strong>Themida v2.x.x.x OEP Finder by Yildo &amp; Mobile46</strong></a></p>
<p>One of the first comments there, tell us:</p>
<blockquote>
<p>Always use an anti-anti-debug plugin (SharpOD, ScyllaHide, etc.)</p>
</blockquote>
<p>Ok! I&rsquo;ve setting up my debugger with the Themida profile offered by <a href="https://github.com/x64dbg/ScyllaHide"target="_blank" rel="external nofollow noopener noreferrer"><strong>ScyllaHide</strong></a>.</p>
<p><figure><a class="lightgallery" href="/images/x64dbgScripts/x64dbg-scyllahide-themida-profile.png" title="ScyllaHide Themida profile" data-thumbnail="/images/x64dbgScripts/x64dbg-scyllahide-themida-profile.png" data-sub-html="<h2>ScyllaHide Themida profile</h2><p>ScyllaHide Themida profile</p>"><img loading="lazy" src='/images/x64dbgScripts/x64dbg-scyllahide-themida-profile.png' alt="ScyllaHide Themida profile" height="193" width="416"></a><figcaption class="image-caption">ScyllaHide Themida profile</figcaption>
  </figure></p>
<p>To run the script, we can press the space bar and wait for the OEP (Original EntryPoint).</p>
<p><figure><a class="lightgallery" href="/images/x64dbgScripts/x64dbg-script-loaded.png" title="x64dbg Script Loaded" data-thumbnail="/images/x64dbgScripts/x64dbg-script-loaded.png" data-sub-html="<h2>x64dbg script loaded</h2><p>x64dbg Script Loaded</p>"><img loading="lazy" src='/images/x64dbgScripts/x64dbg-script-loaded.png' alt="x64dbg script loaded" height="825" width="1100"></a><figcaption class="image-caption">x64dbg Script Loaded</figcaption>
  </figure></p>
<p>After all the steps to execute, we got the OEP.</p>
<p><figure><a class="lightgallery" href="/images/x64dbgScripts/x64dbg-themida-script-finished.png" title="OEP found by the themida script" data-thumbnail="/images/x64dbgScripts/x64dbg-themida-script-finished.png" data-sub-html="<h2>x64dbg OEP</h2><p>OEP found by the themida script</p>"><img loading="lazy" src='/images/x64dbgScripts/x64dbg-themida-script-finished.png' alt="x64dbg OEP" height="1035" width="1892"></a><figcaption class="image-caption">OEP found by the themida script</figcaption>
  </figure></p>
<p>To dump it you can easily use the Scylla with:
<strong>IAT Autosearch &gt; Get Imports &gt; Dump &gt; Fix Dump</strong>.</p>
<p>And then&hellip; you can analyze the malware without any problem :)</p>
<p><figure><a class="lightgallery" href="/images/x64dbgScripts/x64dbg-themida-unpacked.png" title="Themida unpacked using OEP Finder by Yildo &amp; Mobile46" data-thumbnail="/images/x64dbgScripts/x64dbg-themida-unpacked.png" data-sub-html="<h2>x64dbg themida unpacked</h2><p>Themida unpacked using OEP Finder by Yildo &amp; Mobile46</p>"><img loading="lazy" src='/images/x64dbgScripts/x64dbg-themida-unpacked.png' alt="x64dbg themida unpacked" height="805" width="857"></a><figcaption class="image-caption">Themida unpacked using OEP Finder by Yildo & Mobile46</figcaption>
  </figure></p>
<h2 class="heading-element" id="breaking-down-the-script"><span>Breaking Down the Script</span>
  <a href="#breaking-down-the-script" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-as" data-lang="as"><span style="display:flex;"><span><span style="color:#a6e22e">bpd</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bphd</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bpmd</span></span></span></code></pre></div><p>These commands are used to clear or disable any existing breakpoints to ensure they do not interfere with the scriptâ€™s execution:</p>
<ul>
<li><code>bpd</code>: Clear all data breakpoints.</li>
<li><code>bphd</code>: Clear all hardware breakpoints.</li>
<li><code>bpmd</code>: Clear all memory breakpoints.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-as" data-lang="as"><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> <span style="color:#a6e22e">$sectionAddress</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">mod</span>.<span style="color:#a6e22e">main</span>() <span style="color:#f92672">+</span> <span style="color:#a6e22e">mem</span>.<span style="color:#a6e22e">size</span>(<span style="color:#a6e22e">mod</span>.<span style="color:#a6e22e">main</span>())</span></span></code></pre></div><p>It calculates the address where the section starts by adding the size of the main module to the base address of the module.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-as" data-lang="as"><span style="display:flex;"><span><span style="color:#a6e22e">cmp</span> <span style="color:#a6e22e">mem</span>.<span style="color:#a6e22e">isvalid</span>(<span style="color:#a6e22e">$sectionAddress</span>)<span style="color:#f92672">,</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">je</span> <span style="color:#a6e22e">error</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cmp</span> <span style="color:#a6e22e">mem</span>.<span style="color:#a6e22e">iscode</span>(<span style="color:#a6e22e">$sectionAddress</span>)<span style="color:#f92672">,</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">je</span> <span style="color:#a6e22e">error</span></span></span></code></pre></div><ul>
<li><code>mem.isvalid($sectionAddress)</code>: Checks if the memory at <code>$sectionAddress</code> is valid.</li>
<li><code>mem.iscode($sectionAddress)</code>: Checks if the memory at <code>$sectionAddress</code> contains executable code.</li>
</ul>
<p>If either check fails, it jumps to the error label, which outputs an error message.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-as" data-lang="as"><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> <span style="color:#a6e22e">$backup</span><span style="color:#f92672">,</span> [<span style="color:#a6e22e">$sectionAddress</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bph</span> <span style="color:#a6e22e">VirtualProtect</span></span></span></code></pre></div><ul>
<li><code>mov $backup, [$sectionAddress]</code>: Saves the current value at <code>$sectionAddress</code> to <code>$backup</code>.</li>
<li><code>bph VirtualProtect</code>: Sets a hardware breakpoint on <strong>VirtualProtect</strong>, a function used to change memory protection, to monitor modifications.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-as" data-lang="as"><span style="display:flex;"><span><span style="color:#a6e22e">loop</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">erun</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cmp</span> [<span style="color:#a6e22e">$sectionAddress</span>]<span style="color:#f92672">,</span> <span style="color:#a6e22e">$backup</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">jne</span> <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">jmp</span> <span style="color:#a6e22e">loop</span></span></span></code></pre></div><ul>
<li><code>erun</code>: Executes the code until a breakpoint is hit or the process continues.</li>
<li><code>cmp [$sectionAddress], $backup</code>: Compares the current value at <code>$sectionAddress</code> with the <code>$backup</code> value.</li>
</ul>
<p>If the values are not equal <strong>(jne)</strong>, it jumps to the continue label. Otherwise, it loops, repeatedly checking if the value has changed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-as" data-lang="as"><span style="display:flex;"><span><span style="color:#66d9ef">continue</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">erun</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">erun</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bphc</span> <span style="color:#a6e22e">VirtualProtect</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bpm</span> <span style="color:#a6e22e">$sectionAddress</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">erun</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">d</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cmt</span> <span style="color:#a6e22e">cip</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;OEP&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ret</span></span></span></code></pre></div><ul>
<li><code>erun (executed twice)</code>: Continues the execution until it hits another breakpoint.</li>
<li><code>bphc VirtualProtect</code>: Clears the hardware breakpoint on VirtualProtect.</li>
<li><code>bpm $sectionAddress, x</code>: Sets a memory breakpoint (on execute) at <code>$sectionAddress</code>.</li>
<li><code>erun</code>: Continues execution until the memory breakpoint is hit.</li>
<li><code>d</code>: Disassembles the current address.</li>
<li><code>cmt cip, &quot;OEP&quot;</code>: Comments the current instruction pointer <strong>(IP)</strong> with <em>&ldquo;OEP&rdquo;</em>, marking the found Original Entry Point.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-as" data-lang="as"><span style="display:flex;"><span><span style="color:#a6e22e">error</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">msg</span> <span style="color:#e6db74">&#34;This PE file is not supported!&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ret</span></span></span></code></pre></div><p>If the script encounters an unsupported <strong>PE</strong> file, it outputs an error message and terminates.</p>
<h2 class="heading-element" id="conclusion"><span>Conclusion</span>
  <a href="#conclusion" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>You can create scripts to automate most repetitive tasks or make them help, such as unpacking a specific packer, such as Themida.</p>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod"><span title="Updated on 2024-08-28 19:23:17">Updated on 2024-08-28&nbsp;</span>
      </div><div class="post-info-license">
            <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></span>
          </div></div><div class="post-info-line">
        <div class="post-info-md"></div>
        <div class="post-info-share">
          <span><a href="javascript:void(0);" title="Share on X" data-sharer="twitter" data-url="https://moval0x1.github.io/posts/automating-tasks-with-x64dbg-scripts/" data-title="Automating Tasks With X64dbg Scripts" data-via="moval0x1" data-hashtags="Malware,Reversing,Scripts"><i class="fa-brands fa-x-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://moval0x1.github.io/posts/automating-tasks-with-x64dbg-scripts/" data-hashtag="Malware"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://moval0x1.github.io/posts/automating-tasks-with-x64dbg-scripts/"><i class="fa-brands fa-linkedin fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="https://moval0x1.github.io/posts/automating-tasks-with-x64dbg-scripts/" data-title="Automating Tasks With X64dbg Scripts" data-web><i class="fa-brands fa-whatsapp fa-fw" aria-hidden="true"></i></a>
  </span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/malware/" class="post-tag" title="Tags - Malware">Malware</a><a href="/tags/reversing/" class="post-tag" title="Tags - Reversing">Reversing</a><a href="/tags/scripts/" class="post-tag" title="Tags - Scripts">Scripts</a></section>
    <section><span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
    </section>
  </div><div class="post-nav"><a href="/posts/the-abuse-of-exception-handlers/" class="post-nav-item" rel="prev" title="The Abuse of Exception Handlers"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>The Abuse of Exception Handlers</a><a href="/posts/the-peb-walk-anatomy/" class="post-nav-item" rel="next" title="The PEB Walk Anatomy">The PEB Walk Anatomy<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Contents"><h2 class="toc-title">Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.152.2"><img class="hugo-icon" src="/images/hugo.min.svg" alt="Hugo logo" /> Hugo</a> | Theme - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.4.0-alpha.2-20251023040336-063af2cd"><img class="fixit-icon" src="/images/fixit.min.svg" alt="FixIt logo" /> FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2025</span><span class="author" itemprop="copyrightHolder">
              <a href="/about">moval0x1</a></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">This website works best with JavaScript enabled.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/lightgallery/lightgallery.min.js" defer></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js" defer></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/typeit/index.umd.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="/posts/automating-tasks-with-x64dbg-scripts/config/page.js" defer></script><script src="/js/theme.min.js" defer></script></body>
</html>
